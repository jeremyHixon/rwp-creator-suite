# Instagram Follower Analyzer Block - Development Context

## Project Overview
WordPress block for analyzing Instagram follower relationships. Users upload ZIP files containing Instagram data export, which is processed to identify accounts they follow who don't follow back.

## Key Features
- ZIP file upload and extraction
- HTML file parsing (followers_*.html, following*.html)
- Non-mutual follower analysis
- Whitelist functionality for exceptions
- Guest teaser vs authenticated user experience
- Persistent state management

## Architecture Pattern
**Block as Container + JavaScript App**
- Block provides mounting point and upload interface
- Heavy processing done in JavaScript app
- localStorage for guest data, user_meta for authenticated users
- No server-side ZIP processing (client-side only)

## Technical Requirements

### File Processing
- Client-side ZIP extraction using JSZip library
- HTML parsing for Instagram export format
- Handle incremental files (followers_1.html, followers_2.html, etc.)
- Merge multiple files into unified datasets

### Data Structure
```javascript
{
  followers: [
    { username: 'john_doe', profileUrl: 'https://instagram.com/john_doe', timestamp: '2024-01-01' }
  ],
  following: [
    { username: 'jane_smith', profileUrl: 'https://instagram.com/jane_smith', timestamp: '2024-01-01' }
  ],
  notFollowingBack: [
    { username: 'someone', profileUrl: 'https://instagram.com/someone', whitelisted: false }
  ],
  whitelist: ['trusted_account', 'business_partner']
}
```

### User Experience Flow
1. **Guest Users**: Upload → Analysis → Teaser results → Login prompt
2. **Authenticated**: Upload → Analysis → Full results → Whitelist management
3. **Data Persistence**: localStorage for guests, user_meta for users
4. **State Transitions**: Guest data migrates to user account on login

## WordPress Integration

### Block Structure
```
src/blocks/instagram-analyzer/
├── block.json
├── index.js
├── edit.js          // Simple upload interface for editor
├── save.js          // Empty container for JS app
├── style.scss       // Light theme styling
└── editor.scss      // Editor-specific styles
```

### Required Libraries
- **JSZip**: Client-side ZIP extraction
- **DOMParser**: HTML file parsing for Instagram exports
- Standard WordPress block components

### API Endpoints
```php
// User whitelist management (authenticated only)
/wp-json/plugin-name/v1/instagram-whitelist GET/POST
```

### Security Considerations
- File processing entirely client-side (no server ZIP handling)
- Sanitize parsed Instagram usernames
- Validate ZIP file contents before processing
- Rate limiting on whitelist updates
- XSS protection for displayed usernames

## Development Standards

### Block Development
- Follow WordPress block standards exactly
- Use block as simple container only
- Client-side app handles all complex logic
- Light theme DaisyUI styling with minimalistic approach
- Isolated CSS with `blk-` prefixes

### State Management
- localStorage primary storage for all temporary data
- Graceful degradation with warnings if localStorage unavailable
- User preference sync for whitelist (authenticated users only)
- Guest-to-user data migration on login
- Auto-save form state during upload process

### File Processing Architecture
```javascript
class InstagramAnalyzer {
  constructor(container, config) {
    this.container = container;
    this.stateManager = new StateManager();
    this.fileProcessor = new InstagramFileProcessor();
    this.apiClient = new APIClient();
  }
  
  async processZipFile(file) {
    // Extract ZIP client-side
    // Parse HTML files
    // Analyze relationships
    // Update state
    // Render results
  }
}
```

### Component Hierarchy
```
Instagram Analyzer App
├── Upload Interface
│   ├── Drag & Drop Zone
│   ├── Progress Indicator
│   └── Error Messages
├── Analysis Results
│   ├── Summary Stats
│   ├── Non-Mutual List
│   │   ├── Account Item
│   │   │   ├── Profile Link
│   │   │   └── Whitelist Button
│   │   └── Pagination
│   └── Whitelist Section
├── Guest Teaser
│   ├── Sample Results
│   └── Login/Register CTA
└── Settings Panel (authenticated)
    ├── Export Options
    └── Clear Data
```

## Implementation Priorities

### Phase 1: Core Block
- Basic block registration and container
- File upload interface with drag & drop
- Client-side ZIP extraction
- HTML parsing for Instagram format
- Basic follower analysis

### Phase 2: State Management
- localStorage implementation with fallbacks
- State persistence across sessions
- Guest-to-user data migration
- Form state auto-save during upload

### Phase 3: User Experience
- Whitelist functionality for authenticated users
- Guest teaser with login prompts
- Responsive design with container queries
- Error handling and user feedback

### Phase 4: Polish
- Performance optimization
- Advanced filtering and sorting
- Export functionality
- Accessibility enhancements

## WordPress Standards Compliance

### Block Editor Integration
- Placeholder component for editor preview
- No complex functionality in edit.js
- Save.js outputs empty container only
- Block variations for different use cases

### Security Implementation
- Client-side only file processing
- Sanitize all user inputs
- Nonce verification for API calls
- Capability checks for sensitive operations
- Rate limiting for API endpoints

### Performance Considerations
- Lazy load processing modules
- Chunk large datasets for processing
- Debounced API calls for whitelist updates
- Optimized CSS with purging
- Minimal JavaScript footprint

### Style Isolation
- Complete CSS isolation using prefixes
- Light theme DaisyUI components only
- Minimalistic design approach
- Theme-agnostic implementation
- Container query responsive design

## Testing Strategy

### PHP Testing
- API endpoint security
- User capability verification
- Data sanitization
- Migration testing

### JavaScript Testing
- File processing accuracy
- State management reliability
- Storage fallback behavior
- User experience flows

### Integration Testing
- Guest-to-user transitions
- Multi-theme compatibility
- Different Instagram export formats
- Large dataset performance

## Files to Generate
1. **Block Structure**: block.json, index.js, edit.js, save.js
2. **JavaScript App**: File processor, state manager, UI components
3. **PHP Backend**: API endpoints, user preference management
4. **Styling**: Isolated CSS with light theme DaisyUI
5. **Testing**: Unit tests for file processing and state management

## Critical Success Factors
- **Client-Side Processing**: All file handling in browser
- **Storage Strategy**: localStorage primary, user_meta fallback
- **User Experience**: Seamless guest-to-user flow
- **Performance**: Handle large Instagram exports efficiently
- **Security**: Validate all inputs, sanitize outputs
- **WordPress Compliance**: Follow all block development standards
- **Minimalistic Design**: Clean, simple interface with light theme only